<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Food: Clean</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #46b8bc;
            --secondary: #a29bfe;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #2d3436;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }

        /* HEADER */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { font-size: 24px; cursor: pointer; filter: grayscale(1); transition: 0.3s; }
        .nav-item.active { filter: grayscale(0); transform: scale(1.2); }

        /* GRID & CARDS */
        .container { padding: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .category-card { height: 100px; border-radius: 16px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.2); cursor: pointer; }
        
        /* –ö–õ–ê–°–°–´ –ö–ê–¢–ï–ì–û–†–ò–ô */
        .cat-1 { background: linear-gradient(135deg, #ff9a9e, #fad0c4); }
        .cat-2 { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); }
        .cat-3 { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
        .cat-4 { background: linear-gradient(135deg, #fccb90, #d57eeb); }

        /* LISTS */
        .item-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .item-card input { width: 60px; padding: 5px; border: 1px solid #eee; border-radius: 6px; text-align: center; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        .modal-content { background: white; width: 90%; max-width: 400px; margin: 50px auto; border-radius: 20px; padding: 20px; position: relative; max-height: 80vh; overflow-y: auto; }
        
        /* TABS */
        .tabs { display: flex; background: #eee; border-radius: 10px; padding: 4px; margin-bottom: 15px; }
        .tab-btn { flex: 1; border: none; padding: 8px; border-radius: 8px; cursor: pointer; background: transparent; font-weight: bold; }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .btn-save { background: var(--primary); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header">
    <h1 id="title" style="margin:0; font-size: 20px;">Project Food</h1>
</div>

<div id="app" class="container">
    </div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="router.go('menu')">üç¥</div>
    <div class="nav-item" onclick="router.go('calendar')">üìÖ</div>
    <div class="nav-item" onclick="router.go('products')">üçé</div>
</nav>

<div id="modal" class="modal">
    <div class="modal-content" id="modal-content"></div>
</div>

<script>
    const SB_URL = 'https://fwgxtjkqmslbmnecfhwj.supabase.co';
    const SB_KEY = 'sb_publishable_27NdQpJDXhOWC_Y7kzNn7A__xs0jCUi';
    const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

    // –°–û–°–¢–û–Ø–ù–ò–ï (STATE)
    const state = {
        recipes: [],
        products: [],
        currentView: 'menu',
        currentCategory: null
    };

    // –†–û–£–¢–ï–† (–ù–ê–í–ò–ì–ê–¶–ò–Ø)
    const router = {
        async go(view, params = null) {
            state.currentView = view;
            if (params) state.currentCategory = params;
            
            document.querySelectorAll('.nav-item').forEach((el, idx) => {
                el.classList.toggle('active', (view === 'menu' && idx === 0) || (view === 'calendar' && idx === 1) || (view === 'products' && idx === 2));
            });

            this.render();
        },

        async render() {
            const app = document.getElementById('app');
            app.innerHTML = '<p style="text-align:center">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';

            if (state.currentView === 'menu') {
                if (!state.currentCategory) {
                    app.innerHTML = `
                        <div class="grid">
                            <div class="category-card cat-1" onclick="router.go('menu', '–ó–∞–≤—Ç—Ä–∞–∫')">–ó–∞–≤—Ç—Ä–∞–∫–∏</div>
                            <div class="category-card cat-2" onclick="router.go('menu', '–°—É–ø')">–°—É–ø—ã</div>
                            <div class="category-card cat-3" onclick="router.go('menu', '–í—Ç–æ—Ä–æ–µ')">–í—Ç–æ—Ä—ã–µ –±–ª—é–¥–∞</div>
                            <div class="category-card cat-4" onclick="router.go('menu', '–î–µ—Å–µ—Ä—Ç')">–î–µ—Å–µ—Ä—Ç—ã</div>
                        </div>`;
                } else {
                    const { data } = await supabaseClient.from('recipes').select('*').eq('category', state.currentCategory);
                    app.innerHTML = `<button onclick="router.go('menu')" style="margin-bottom:15px; border:none; background:none; color:var(--primary); font-weight:bold;">‚¨Ö –ù–∞–∑–∞–¥</button>
                                     <div class="grid">${data.map(r => `<div class="item-card" onclick="ui.openRecipe(${r.id})">${r.name}</div>`).join('')}</div>`;
                }
            }

            if (state.currentView === 'products') {
                const { data } = await supabaseClient.from('products').select('*').order('name');
                app.innerHTML = `<h2>–ë–∞–∑–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>` + data.map(p => `
                    <div class="item-card">
                        <div><b>${p.name}</b><br><small>${p.kcal} –∫–∫–∞–ª</small></div>
                        <div><input type="number" value="${p.price}" onchange="ui.updatePrice(${p.id}, this.value)"> ‚ÇΩ</div>
                    </div>
                `).join('');
            }
        }
    };

    // UI –õ–û–ì–ò–ö–ê
    const ui = {
        async openRecipe(id) {
            const { data: r } = await supabaseClient.from('recipes').select('*').eq('id', id).single();
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            
            content.innerHTML = `
                <span onclick="ui.closeModal()" style="position:absolute; right:20px; top:10px; font-size:24px; cursor:pointer;">&times;</span>
                <h3>${r.name}</h3>
                <div class="tabs">
                    <button class="tab-btn active" onclick="ui.switchTab('t-ings', this)">–°–æ—Å—Ç–∞–≤</button>
                    <button class="tab-btn" onclick="ui.switchTab('t-steps', this)">–ì–æ—Ç–æ–≤–∫–∞</button>
                </div>
                <div id="t-ings" class="tab-content">${r.ings || '–ù–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤'}</div>
                <div id="t-steps" class="tab-content" style="display:none;">
                    <textarea id="instr" style="width:100%; height:150px; border-radius:10px; padding:10px; border:1px solid #ddd;">${r.instructions || ''}</textarea>
                    <button class="btn-save" onclick="ui.saveInstructions(${r.id})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            `;
            modal.style.display = 'block';
        },

        async saveInstructions(id) {
            const text = document.getElementById('instr').value;
            await supabaseClient.from('recipes').update({ instructions: text }).eq('id', id);
            alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        },

        switchTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).style.display = 'block';
            btn.classList.add('active');
        },

        async updatePrice(id, val) {
            await supabaseClient.from('products').update({ price: parseFloat(val) }).eq('id', id);
        },

        closeModal() { document.getElementById('modal').style.display = 'none'; }
    };

    // –°—Ç–∞—Ä—Ç
    router.render();
</script>

</body>
</html>
