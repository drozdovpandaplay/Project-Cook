<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Food: Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2563eb; --secondary: #059669; --bg: #f8fafc; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 15px; margin: 0; color: #1e293b; }
        .card { background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        h2 { margin: 0 0 15px 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        textarea { width: 100%; height: 120px; border: 1px solid #cbd5e1; border-radius: 10px; padding: 12px; box-sizing: border-box; font-family: 'Courier New', monospace; font-size: 14px; background: #f1f5f9; }
        .btn { background: var(--primary); color: white; border: none; padding: 14px; width: 100%; border-radius: 10px; font-weight: 600; font-size: 16px; cursor: pointer; transition: opacity 0.2s; margin-top: 10px; }
        .btn:active { opacity: 0.7; }
        .btn-sql { background: var(--secondary); }
        .url-display { background: #f1f5f9; padding: 12px; border-radius: 8px; font-size: 12px; word-break: break-all; margin-top: 15px; border: 1px dashed #cbd5e1; display: none; color: #475569; }
        .status { font-size: 12px; color: #64748b; margin-top: 5px; text-align: center; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üñºÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤ Storage</h2>
        <input type="file" id="imageInput" accept="image/*" style="width: 100%;">
        <button class="btn" onclick="uploadPhoto()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
        <div id="urlResult" class="url-display"></div>
        <p class="status">–§–∞–π–ª—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±–∞–∫–µ—Ç 'recipe-images'</p>
    </div>

    <div class="card">
        <h2>üíª SQL –¢–µ—Ä–º–∏–Ω–∞–ª</h2>
        <textarea id="sqlInput" placeholder="INSERT INTO recipes..."></textarea>
        <button class="btn btn-sql" onclick="runSQL()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        <p class="status">–ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é exec_sql</p>
    </div>

<script>
    // –ù–ê–°–¢–†–û–ô–ö–ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
    const SUPABASE_URL = 'https://–¢–í–û–ô_–ü–†–û–ï–ö–¢.supabase.co';
    const SUPABASE_KEY = '–¢–í–û–ô_–ö–õ–Æ–ß';

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 1. –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò –§–û–¢–û
    async function uploadPhoto() {
        const fileInput = document.getElementById('imageInput');
        const file = fileInput.files[0];
        const resDiv = document.getElementById('urlResult');

        if (!file) {
            alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ!');
            return;
        }

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
        const fileName = `recipe_${Date.now()}.jpg`;

        try {
            const { data, error } = await supabaseClient.storage
                .from('recipe-images')
                .upload(fileName, file);

            if (error) throw error;

            // –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
            const { data: urlData } = supabaseClient.storage
                .from('recipe-images')
                .getPublicUrl(fileName);

            resDiv.innerText = urlData.publicUrl;
            resDiv.style.display = 'block';
            alert('‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –°—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Å–µ—Ä–æ–º –ø–æ–ª–µ.');
        } catch (err) {
            console.error(err);
            alert('‚ùå –û—à–∏–±–∫–∞ Storage: ' + err.message);
        }
    }

    // 2. –§–£–ù–ö–¶–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø SQL
    async function runSQL() {
        const sql = document.getElementById('sqlInput').value.trim();
        
        if (!sql) {
            alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ SQL –∫–æ–¥!');
            return;
        }

        try {
            // –í—ã–∑—ã–≤–∞–µ–º RPC —Ñ—É–Ω–∫—Ü–∏—é –≤ Supabase
            const { data, error } = await supabaseClient.rpc('exec_sql', { query: sql });

            if (error) throw error;

            alert('üöÄ –£—Å–ø–µ—à–Ω–æ! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞.');
            document.getElementById('sqlInput').value = ''; // –ß–∏—Å—Ç–∏–º –ø–æ–ª–µ
        } catch (err) {
            console.error(err);
            alert('‚ùå –û—à–∏–±–∫–∞ SQL: ' + err.message);
        }
    }
</script>

</body>
</html>
